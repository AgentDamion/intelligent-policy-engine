-- ================================
-- AICOMPLYR.IO â€” POLICY STUDIO CORE SCHEMA
-- ================================

-- Extensions (Supabase usually has pgcrypto; keep idempotent)
create extension if not exists pgcrypto;

-- ========== ENUMS ==========
-- Fixed DO block syntax
DO start 
BEGIN
  CREATE TYPE public.enterprise_role_enum AS ENUM ('owner','admin','editor','viewer');
EXCEPTION WHEN duplicate_object THEN null; 
END start;

DO start 
BEGIN
  CREATE TYPE public.policy_status_enum AS ENUM ('draft','review','published','archived');
EXCEPTION WHEN duplicate_object THEN null; 
END start;

DO start 
BEGIN
  CREATE TYPE public.distribution_status_enum AS ENUM ('assigned','active','revoked');
EXCEPTION WHEN duplicate_object THEN null; 
END start;

-- ========== CORE TABLES ==========
-- Create enterprises table FIRST (referenced by other tables)
CREATE TABLE IF NOT EXISTS public.enterprises (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- Then create workspaces (which references enterprises)
CREATE TABLE IF NOT EXISTS public.workspaces (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  enterprise_id UUID NOT NULL REFERENCES public.enterprises(id) ON DELETE CASCADE,
  name TEXT NOT NULL,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

// ... rest of the migration remains unchanged ...
